<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" rel="stylesheet">
</head>

<body>
    <ion-app>
        <ion-header>
            <ion-toolbar>
                <ion-title>Testové otázky</ion-title>
            </ion-toolbar>
        </ion-header>

        <ion-content class="ion-padding">
            <div id="quiz-container"></div>

            <ion-button expand="block" onclick="submitAnswers()">Odoslať odpovede</ion-button>

            <ion-card id="result-card" style="display:none; margin-top:20px;">
                <ion-card-header>
                    <ion-card-title>Výsledok</ion-card-title>
                </ion-card-header>
                <ion-card-content id="result-content">
                </ion-card-content>
            </ion-card>
        </ion-content>
    </ion-app>

    <script>
        let questions = [];

        fetch('questions.xml')
            .then(response => response.text())
            .then(data => {
                const parser = new DOMParser();
                const xml = parser.parseFromString(data, "application/xml");
                const questionNodes = xml.querySelectorAll('question');
                questions = [];

                questionNodes.forEach((qNode, index) => {
                    const text = qNode.querySelector('text').textContent;
                    const options = qNode.querySelectorAll('option');
                    const answer = qNode.querySelector('answer').textContent;

                    const q = {
                        id: index,
                        text: text,
                        options: Array.from(options).map(opt => ({
                            id: opt.getAttribute('id'),
                            text: opt.textContent
                        })),
                        correct: answer
                    };

                    questions.push(q);
                });

                displayQuestions();
            });

        function displayQuestions() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const card = document.createElement('ion-card');
                card.innerHTML = `
          <ion-card-header>
            <ion-card-title>Otázka ${index + 1}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p>${q.text}</p>
            <ion-radio-group id="q${index}">
              ${q.options.map(opt => `
                <ion-item>
                  <ion-label>${opt.id}) ${opt.text}</ion-label>
                  <ion-radio slot="start" value="${opt.id}"></ion-radio>
                </ion-item>
              `).join('')}
            </ion-radio-group>
          </ion-card-content>
        `;
                container.appendChild(card);
            });
        }

        function submitAnswers() {
            let score = 0;
            questions.forEach((q, index) => {
                const group = document.getElementById(`q${index}`);
                const selected = group.querySelector('ion-radio[checked]')?.value || group.querySelector('ion-radio[aria-checked="true"]')?.value;
                if (selected === q.correct) {
                    score++;
                }
            });
            const resultCard = document.getElementById('result-card');
            const resultContent = document.getElementById('result-content');
            resultContent.innerHTML = `Správne odpovede: ${score} z ${questions.length}`;
            resultCard.style.display = 'block';
        }
    </script>
</body>

</html>